!function(a){var g,b=function(){var d,e,f,a=["webkit","moz","ms"],b=document.createElement("div").style,c="transform"in b?"transform":void 0;for(d=0,e=a.length;e>d;d++)if(f=a[d]+"Transform",f in b){c=f;break}return c}(),c=function(c,d){if(c.item=this,this.element=c,"IMG"===c.tagName?(this.fullWidth=c.width,this.fullHeight=c.height):(c.style.display="inline-block",this.fullWidth=c.offsetWidth,this.fullHeight=c.offsetHeight),c.style.position="absolute",d.mirror&&"IMG"===this.element.tagName){this.reflection=a(c).reflect(d.mirror).next()[0];var e=a(this.reflection);this.reflection.fullHeight=e.height(),e.css("margin-top",d.mirror.gap+"px"),e.css("width","100%"),c.style.width="100%",this.element=this.element.parentNode,this.element.item=this,this.element.alt=c.alt,this.element.title=c.title}b&&d.transforms&&(this.element.style[b+"Origin"]="0 0"),this.moveTo=function(a,c,e){this.width=this.fullWidth*e,this.height=this.fullHeight*e,this.x=a,this.y=c,this.scale=e;var f=this.element.style;f.zIndex=0|""+100*e,b&&d.transforms?f[b]="translate("+a+"px, "+c+"px) scale("+e+")":(d.mirror&&"IMG"===this.element.tagName&&(this.reflection.style.marginTop=d.mirror.gap*e+"px"),f.width=this.width+"px",f.left=a+"px",f.top=c+"px")}},d=function(){return window.performance&&window.performance.now?function(){return performance.now()}:function(){return+new Date}}(),e=window.cancelAnimationFrame||window.cancelRequestAnimationFrame,f=window.requestAnimationFrame;!function(){var b,c,a=["webkit","moz","ms"];for(b=0,c=a.length;c>b&&!e;b++)e=window[a[b]+"CancelAnimationFrame"]||window[a[b]+"CancelRequestAnimationFrame"],f=f&&window[a[b]+"RequestAnimationFrame"]}(),g=function(b,g){var j,h=this,i=a(b);this.items=[],this.xOrigin=null===g.xOrigin?.5*i.width():g.xOrigin,this.yOrigin=null===g.yOrigin?.1*i.height():g.yOrigin,this.xRadius=null===g.xRadius?i.width()/2.3:g.xRadius,this.yRadius=null===g.yRadius?i.height()/6:g.yRadius,this.farScale=g.farScale,this.rotation=this.destRotation=Math.PI/2,this.speed=g.speed,this.smooth=g.smooth,this.fps=g.fps,this.timer=0,this.autoPlayAmount=g.autoPlay,this.autoPlayDelay=g.autoPlayDelay,this.autoPlayTimer=0,this.onLoaded=g.onLoaded,this.onRendered=g.onRendered,this.itemOptions={transforms:g.transforms},g.mirror&&(this.itemOptions.mirror=a.extend({gap:2},g.mirror)),i.css({position:"relative",overflow:"hidden"}),this.rotateItem=function(a,b){var c=this.items[a],d=Math.sin(b),e=this.farScale,f=e+.5*(1-e)*(d+1);c.moveTo(this.xOrigin+f*(Math.cos(b)*this.xRadius-.5*c.fullWidth),this.yOrigin+f*d*this.yRadius,f)},this.render=function(){var d,a=this.items.length,b=2*Math.PI/a,c=this.rotation;for(d=0;a>d;d++)this.rotateItem(d,c),c+=b;"function"==typeof this.onRendered&&this.onRendered(this)},this.playFrame=function(){var a=h.destRotation-h.rotation,b=d(),c=.002*(b-h.lastTime);h.lastTime=b,Math.abs(a)<.003?(h.rotation=h.destRotation,h.pause()):(h.rotation=h.destRotation-a/(1+h.speed*c),h.scheduleNextFrame()),h.render()},this.scheduleNextFrame=function(){this.lastTime=d(),this.timer=this.smooth&&e?f(h.playFrame):setTimeout(h.playFrame,1e3/this.fps)},this.itemsRotated=function(){return this.items.length*(Math.PI/2-this.rotation)/(2*Math.PI)},this.floatIndex=function(){var a=this.items.length,b=this.itemsRotated()%a;return 0>b?b+a:b},this.nearestIndex=function(){return Math.round(this.floatIndex())%this.items.length},this.nearestItem=function(){return this.items[this.nearestIndex()]},this.play=function(){0===this.timer&&this.scheduleNextFrame()},this.pause=function(){this.smooth&&e?e(this.timer):clearTimeout(this.timer),this.timer=0},this.go=function(a){this.destRotation+=2*Math.PI/this.items.length*a,this.play()},this.deactivate=function(){this.pause(),clearInterval(this.autoPlayTimer),g.buttonLeft.unbind("click"),g.buttonRight.unbind("click"),i.unbind(".cloud9")},this.autoPlay=function(){this.autoPlayTimer=setInterval(function(){h.go(h.autoPlayAmount)},this.autoPlayDelay)},this.enableAutoPlay=function(){i.bind("mouseover.cloud9",function(){clearInterval(h.autoPlayTimer)}),i.bind("mouseout.cloud9",function(){h.autoPlay()}),this.autoPlay()},this.bindControls=function(){g.buttonLeft.bind("click",function(){return h.go(-1),!1}),g.buttonRight.bind("click",function(){return h.go(1),!1}),g.mouseWheel&&i.bind("mousewheel.cloud9",function(a,b){return h.go(b>0?1:-1),!1}),g.bringToFront&&i.bind("click.cloud9",function(b){var d,e,f,c=a(b.target).closest("."+g.itemClass);0!==c.length&&(d=h.items.indexOf(c[0].item),e=h.items.length,f=d-h.floatIndex()%e,2*Math.abs(f)>e&&(f+=f>0?-e:e),h.destRotation=h.rotation,h.go(-f))})},j=i.find("."+g.itemClass),this.finishInit=function(){var a,b;for(a=0;a<j.length;a++)if(b=j[a],"IMG"===b.tagName&&(void 0===b.width||void 0!==b.complete&&!b.complete))return;for(clearInterval(this.initTimer),a=0;a<j.length;a++)this.items.push(new c(j[a],this.itemOptions));i.bind("mousedown onselectstart",function(){return!1}),0!==this.autoPlayAmount&&this.enableAutoPlay(),this.bindControls(),this.render(),"function"==typeof this.onLoaded&&this.onLoaded(this)},this.initTimer=setInterval(function(){h.finishInit()},50)},a.fn.Cloud9Carousel=function(b){return this.each(function(){b=a.extend({xOrigin:null,yOrigin:null,xRadius:null,yRadius:null,farScale:.5,transforms:!0,smooth:!0,fps:30,speed:4,autoPlay:0,autoPlayDelay:4e3,bringToFront:!1,itemClass:"cloud9-item",handle:"carousel"},b),a(this).data(b.handle,new g(this,b))})}}(window.jQuery||window.Zepto);